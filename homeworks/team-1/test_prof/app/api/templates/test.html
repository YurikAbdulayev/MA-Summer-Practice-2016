<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <link rel="stylesheet" href="../static/css/main.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
<div class="content">
    <div id="body"></div>
    <!--<h1 class="head-text">hasfijlja</h1>-->
    <!--<div id="listTests"></div>-->
    <!--<form action="">-->
    <!--<p><label><input type="radio" name="answer" value="{{id}}">з розповідей, на слух {{id}}</label></p>-->
    <!--<p><label><input type="radio" name="answer" value="a2">візуально (люблю ілюстрації)</label></p>-->
    <!--<p><label><input type="radio" name="answer" value="a3">через дії, практично</label></p>-->
    <!--<p><label><input type="radio" name="answer" value="a4">з Інтернету, книг, довідників</label></p>-->
    <!--<input onclick="loadTests()" type="submit" value="Наступне запитання" class="button">-->
    <!--</form>-->
</div>
<script>
    var id = '{{id}}';
    outTest = [];
    var xmlhttp = new XMLHttpRequest();
    var url = "http://127.0.0.1:5000/api/v1.0/questions/" + id + "/direction/all";

    xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            myFunction(xmlhttp.responseText);
        }
    };
    xmlhttp.open("GET", url, false);
    xmlhttp.send();

    function myFunction(response) {
        var data = JSON.parse(response);
        for (i = 0; i < data["list_ids"].length; i++) {
            if(data["list_ids"][i]["direction_id"] == '0')
            outTest[i] = data["list_ids"][i]["question_id"];
        }
    }
//    alert(outTest)
    outView = "";
    outView += "<div id ='myForm'>";

    for (count = 0; count < outTest.length; count++) {
        var url = "http://127.0.0.1:5000/api/v1.0/question/" + outTest[count];

        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                f(xmlhttp.responseText, count);
            }
        };
        xmlhttp.open("GET", url, false);
        xmlhttp.send();

        function f(response, i) {
            data = JSON.parse(response);
            outView += "<h1 class='head-text'>" + data["question"]["body"] + "</h1>";
//            alert(question["question"]["body"]);
            for (answ = 0; answ < data["question"]["answers"].length; answ++) {
                outView += "<p><label><input type='radio' id=" + i + " name='answer" + i + "' value=" +
                        data["question"]["answers"][answ]["direction"] + ">" +
                        data["question"]["answers"][answ]["body"] + "</label></p>"

            }

        }
    }
    outView += "</div>";
    outView += "<input onclick='check(outTest.length)' type='submit' value='Порахувати' class='button'>";

    document.getElementById("body").innerHTML = outView;

    array = [];
    function check(lengQ) {
        for (countQ = 0; countQ < lengQ; countQ++ ) {
            var answer = document.getElementsByName("answer" + countQ);
            var len = answer.length;

            for (k = 0; k < len; k++) {
                if (answer[k].checked) {
//                alert("ok" + answer[k].value);
                    array[countQ] = answer[k].value;
                }
            }
        }
        alert(array);

//        povt = [];
//        for (i=0; i < array.length; i++){
//            count = 0;
//            for (j= 0; j< array.length; j++){
//                if(array[i] == array[j]){
//                    count++;
//                }
//            }
//            povt[array[i]] = count;
//        }
//        alert(povt)

    }

</script>
<script src="../static/js/main.js"></script>
</body>
</html>